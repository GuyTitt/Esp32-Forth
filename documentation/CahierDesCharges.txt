# Fichier documentation\cahierDesCharges.txt Version: 0.0
# objectif : décrire les souhaits du projet à l'attention de l'IA
#
Je souhaite réaliser ( non pas utiliser un programme existant) avec ta collaboration un interpréteur/compilateur forth sur un esp32-S3.
Pour cela je souhaite partir de rien. Ce projet a deux objectifs  - pédagogique ( amélioration de mes connaissances) - utile les projets suivant seront fait à partir de ce langage.
1) Quelques informations pour ce projet:
   -partir de rien il faut utiliser l'assembleur de l'esp32-S3 (Tensilica Xtensa LX7 )
   -le cross-assemblage se fera sur windows 10
     -- donne moi la procédure pour avoir une chaine de traitement automatique ( make ) soit
	   ---directement sous windows
	   ---en utilisant wsl ( mais je ne me rappelle plus du pass superviseur ! on peut le réinitialiser )
   -les échanges de fichier se feront sur github https://github.com/GuyTitt/Esp32-Forth
   -Pour faciliter les tests nous utiliserons le simulateur wokwi gratuit il peut venir chercher les binaires sur github.
   
2) peux tu compléter en améliorant:
  Vocabulaire minimal:
    Opérateurs mathématiques : + - * / mod abs negate
    opérateurs logiques : and or xor not
    flux et Boucles : while  if then else
    pile : dup swap drop over rot
    entrée sortie : key emit . .s
	chaine : "
	commentaire : ( ) \
  Vocabulaire spécifique à l'esp32:
    timers: start stop read
    GPIO: get set input output
	analogique : read set
    Interruptions : enable disable clear
    SPDIFF : read write
	network : 
    
 3) j'ai commencé à faire ce premier tri, perfectionne le, pour le Vocabulaire minimal, ne retient que les mots principaux de "forth", ceux qui ne peuvent être traduit en d'autres mots "forth". nous appelleront la collection de ces mots le vocabulaire minimal ( il doit être le plus réduit possible) et être écrit en assembleur et avoir l'emprunte la plus faible et la plus rapide. Tu trouvera dans le dossier src un premier jet non vérifié
 4) Les autres mots (vocabulaire usuel et spécifique ) seront obtenus (macro) à partir du vocabulaire minimal. Il seront dans des fichiers spiff interprétés au lancement du programme s'il sont présent sur le disque. Si une pin spécifiée est  à 0 alors les fichiers vocabulaires ne seront pas lu et interprétés, cela sera utilisé pour faire des tests.
 
 5) Je pense ne rien avoir oublié mais je pense que ce cahier des charges initial évoluera au fur et à mesure de la réalisation de ce projet.
 6) Commencons en installant la chaine de production sur windows et en verifiant que l'on sait faire clignoter la led gpio 2 à 1 hz 
 Pour faire l'essai initial utilisons le dossier prerequis 
 7) à moins que tu ais une meilleure méthode à me proposer. je suis preneur de toute idée.
 
Créer un programme  en assembleur esp32 à partir de windows 10
Ce programme est à terme un interpréteur forth pédagogique
Seule quelques mots sont ecrits en assembleur,et constituent le vocabulaire minimal
Les autres mots ( On verra plus tard lesquels ensemble) seront ds macros écrites à partir du
vocabulaire minimal.
j'ai déjà travaillé le projet il faut maintenant l'achever
Tu peux trouver les fichiers dans https://github.com/GuyTitt/Esp32-Forth
j'ai installé esp-idf-tools-setup-offline-5.5.1 sur mon poste
J'arrive à assembler mais la suite n'est pas encore opérationnelle 
La première étape consiste à avoir une toolchain opérationelle produisant un  fichier binaire
Dans la seconde étape
Nous utiliserons wokwi gratuit  pour simuler le fonctionnement
il faut qu'il prenne sur github le fichier programme (tu me donneras la procédure)
les programmes doivent avoir un numéro de version incrémenté à chaque modification

Revenons sur nos règles de fonctionnement :

1a) je constate que tu n'es pas sûr que les fichiers sources utilisés soient de la dernière version que tu m'as fournis. C'est complétement anormal ! En conséquence il faut non pas retomber dans la même erreur mais progresser .

1b) Ajoutons dans le programme build.bat entre les rubriques 2 ( vérification ) et 3 (compilation ) un affichage dans un fichier log des fichiers qui seront utilisés avec leur version. Pour cela tous les fichiers composant le programme  doivent se trouver dans le même dossier . Je pense que tu as choisi "/main". Il est ainsi aisé de faire la liste des programmes de ce dossier et d'en extraire de la dernière ligne le numéro de version, puisque nous avons convenu d'un format pour cette ligne. Si tu le désires tu peux également scruter d'autres dossiers pour incorporer dans le log leur nom et numéro de version sous forme d'un tableau ascii . Je propose que le log soit nommé "/log/build.log". Ne tiens pas compte des dossiers "nppBackup" et de leur contenu, ils sont propres à mon éditeur de texte.

Proposition d'amélioration de la chaine de production:
En regardant les log j'ai vu que esp-idf-tools-setup-offline-5.5.1 embarquait un interpréteur python.
Je te propose pour simplifier des batch compliqués d'utiliser la puissance de python pour effectuer l'équivalent, malheureusement le module  logging si elle est absent.
on aurait outils\construction.bat qui testerait si la variable d'environnement IDF_TOOLS_PATH était présente sinon il lancerait le batch export
puis dans le bon batch il lancerait constructeur.py qui ferait le reste du travail en prenant dans source\config.json toutes les informations nécessaires.
On pourrait ainsi dire dans le batch si la cible est une simulation wokwi ou un esp local , si on veut le télécharger en trouvant le com connecté, ou si l'on veut mettre le github à jour ou créer une branche , indiquer url de github, si l'on veux télécharger le fichier dans wokwi et plus encore peut être, si tu as de l'inspiration propose des améliorations.
3) Qu'en penses-tu ?

  

# Fichier documentation\cahierDesCharges.txt Version: 0.0
